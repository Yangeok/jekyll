---
layout: post
title: 'MySQL에서 쇼핑몰 상품 옵션 설계하기'
author: Yangeok
categories: Database
comments: true
tags:
  [
    sql mysql 쇼핑몰 db shopping mall 데이터베이스 디비 테이블 디자인 컬럼 색상 컬러 사이즈 크기 column size color colour design table database 옵션 option opts opt options 상품 products product,
  ]
cover: '/assets/mysql.jpg'
---

실제 서비스에 들어가는건 아니지만 쇼핑몰 구축하는중 상품은 옵션이 있다는걸 깜빡하고 테이블을 설계했습니다. 아직까지는 [faker](https://www.npmjs.com/package/faker)로 페이크데이터만 만들었습니다만. 상품 색상과 사이즈를 그냥 생각없이 랜덤한 문자열로만 넣어서 상품 색상과 사이즈는 단일 색상, 단일 사이즈가 되버렸습니다. 실제 서비스같이 만들려면 다채로운 색상과 사이즈가 필요합니다. 뷰로 보내줄때는 배열로 보내주는게 프론트에서 사용하기에 편하겠죠. 그래서 페이크 데이터를 다음과 같이 만들어지도록 바꿔봤습니다.

```js
productColor: [
  faker.commerce.color(),
  faker.commerce.color(),
  faker.commerce.color(),
  faker.commerce.color(),
  faker.commerce.color()
  ],

  (...)
```

MySQL에서는 컬럼에 배열로 저장이 안된다는걸 모른 저는 저런 멍청한 짓을 해버렸습니다. 저대로 페이크데이터를 입력하려고 하니 Sequelize에서는 유효성 에러가 뜨더군요. 배열이나 객체는 필드에 올 수가 없다고. 맞습니다. MySQL에서는 안된다더군요. PostgreSQL에서는 배열도 JSON데이터도 저장이 된다고 합니다. 게다가 둘간의 마이그레이션이 생각보다 간단하다니 다음에 기회가 된다면 써봐야겠습니다.

개발환경에서 콘솔에서 MySQL에 접속해서 먼저

```sql
CREATE DATABASE test;

CREATE TABLE products
(
    p_id INT,
    p_name VARCHAR(32),
    PRIMARY KEY (p_id)
);

CREATE TABLE color
(
    p_id INT,
    p_color VARCHAR(24)
);

CREATE TABLE size
(
    p_id INT,
    p_size VARCHAR(12)
);

INSERT INTO products
VALUES
(1, 'test1'),
(2, 'test2'),
(3, 'test3'),
(4, 'test4'),
(5, 'test5');

INSERT INTO color
VALUES
(1, 'black'),
(1, 'white'),
(1, 'gray'),
(2, 'black'),
(2, 'beige'),
(3, 'blue'),
(3, 'red'),
(3, 'green'),
(4, 'black'),
(4, 'white'),
(4, 'beige'),
(4, 'gray'),
(4, 'mustard'),
(5, 'black'),
(5, 'white');

INSERT INTO size
VALUES
(1, 'S'),
(1, 'M'),
(1, 'L'),
(1, 'XL'),
(2, 'Free'),
(3, 'XS'),
(3, 'S'),
(3, 'M'),
(3, 'L'),
(3, 'XL'),
(4, 'M'),
(4, 'L'),
(4, 'XL'),
(5, 'Free');
```

## 쿼리

```sql
SELECT p.p_id, p.p_name, s.p_size, c.p_color
FROM products AS p
LEFT JOIN size AS s
ON p.p_id = s.p_id
LEFT JOIN color AS c
ON p.p_id = c.p_id;
```

## json으로

```json
{
  "products": [
    {
      "p_id": "1",
      "p_name": "test1",
      "p_color": ["black", "white", "gray"],
      "p_size": ["S", "M", "L", "XL"]
    },
    {
      "p_id": "2",
      "p_name": "test2",
      "p_color": ["black", "beige"],
      "p_size": ["Free"]
    },
    {
      "p_id": "3",
      "p_name": "test3",
      "p_color": ["blue", "red", "green"],
      "p_size": ["XS", "S", "M", "L", "XL"]
    },
    {
      "p_id": "4",
      "p_name": "test4",
      "p_color": ["black", "white", "beige", "gray", "mustard"],
      "p_size": ["M", "L", "XL"]
    },
    {
      "p_id": "5",
      "p_name": "test5",
      "p_color": ["black", "white"],
      "p_size": ["Free"]
    }
  ]
}
```
